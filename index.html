<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LinkedIn Outreach Tracker</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif; }
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
body { background:linear-gradient(135deg, #f0f4ff 0%, #f8fafc 100%); color:#1e293b; min-height:100vh; }
.topbar { background:linear-gradient(135deg, #0a66c2 0%, #004182 100%); color:white; padding:16px 32px; display:flex; align-items:center; gap:16px; box-shadow: 0 4px 20px rgba(10,102,194,0.3); }
.topbar h1 { font-size:20px; font-weight:800; flex:1; letter-spacing:-0.5px; }
.topbar h1::before { content:"üìä "; }
.read-badge { background:#fbbf24; color:#78350f; font-size:11px; font-weight:800; padding:5px 12px; border-radius:99px; }
.btn-top { background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.3); color:white; border-radius:10px; padding:9px 18px; font-size:13px; font-weight:600; cursor:pointer; transition: all 0.2s ease; }
.btn-top:hover { background:rgba(255,255,255,0.3); transform:translateY(-1px); }
.container { max-width:1250px; margin:0 auto; padding:28px; }
.stats { display:grid; grid-template-columns:repeat(4,1fr); gap:18px; margin-bottom:24px; }
.stat-card { background:white; border-radius:16px; padding:22px 24px; box-shadow:0 4px 20px rgba(0,0,0,0.06); border:1px solid #e2e8f0; transition:all 0.2s ease; }
.stat-card:hover { transform:translateY(-2px); box-shadow:0 8px 30px rgba(0,0,0,0.1); }
.stat-card .v { font-size:32px; font-weight:800; letter-spacing:-1px; }
.stat-card .l { font-size:13px; color:#94a3b8; margin-top:4px; font-weight:500; }
.blue{color:#0a66c2;}.green{color:#16a34a;}.purple{color:#7c3aed;}.orange{color:#ea580c;}
.controls { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:18px; }
.controls input, .controls select { border:1px solid #e2e8f0; border-radius:10px; padding:10px 14px; font-size:13px; outline:none; background:white; transition:all 0.2s ease; box-shadow:0 2px 8px rgba(0,0,0,0.04); }
.controls input:focus, .controls select:focus { border-color:#0a66c2; box-shadow:0 0 0 3px rgba(10,102,194,0.1); }
.controls input { width:220px; }
.pill { font-size:12px; padding:7px 16px; border-radius:99px; border:1px solid #e2e8f0; background:white; cursor:pointer; font-weight:600; color:#475569; white-space:nowrap; transition:all 0.15s ease; }
.pill:hover { background:#f8fafc; border-color:#cbd5e1; }
.pill.active { background:linear-gradient(135deg, #0a66c2 0%, #0958a8 100%); color:white; border-color:transparent; box-shadow:0 2px 8px rgba(10,102,194,0.3); }
.ml { margin-left:auto; }
.btn-sm { background:white; border:1px solid #e2e8f0; border-radius:10px; padding:9px 16px; font-size:13px; font-weight:600; cursor:pointer; color:#475569; transition:all 0.2s; }
.btn-sm:hover { background:#f8fafc; border-color:#cbd5e1; }
.table-wrap { background:white; border-radius:16px; box-shadow:0 4px 20px rgba(0,0,0,0.06); overflow:hidden; border:1px solid #e2e8f0; }
table { width:100%; border-collapse:collapse; font-size:13px; }
thead { background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); }
th { text-align:left; padding:14px 18px; font-size:11px; font-weight:700; color:#64748b; text-transform:uppercase; letter-spacing:.05em; }
td { padding:14px 18px; border-top:1px solid #f1f5f9; }
tr { transition:background 0.15s ease; }
tr:hover td { background:#f8fafc; }
a.ll { color:#0a66c2; font-weight:600; text-decoration:none; transition:color 0.15s; }
a.ll:hover { color:#004182; text-decoration:underline; }
.ss { font-size:11px; font-weight:700; padding:6px 12px; border-radius:99px; border:none; cursor:pointer; outline:none; transition:all 0.15s ease; }
.ss[disabled] { cursor:default; appearance:none; -webkit-appearance:none; }
.s0{background:linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);color:#1d4ed8;}
.s1{background:linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);color:#0369a1;}
.s2{background:linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);color:#065f46;}
.s2b{background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);color:#92400e;}
.s3{background:linear-gradient(135deg, #fef9c3 0%, #fef08a 100%);color:#854d0e;}
.s4{background:linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);color:#15803d;}
.s4b{background:linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);color:#5b21b6;}
.s4c{background:linear-gradient(135deg, #fbcfe8 0%, #f9a8d4 100%);color:#9d174d;}
.s5b{background:linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);color:#b91c1c;}
.s5c{background:linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 100%);color:#047857;}
.s5{background:linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);color:#6d28d9;}
.s6{background:linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);color:#b91c1c;}
.s7{background:linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);color:#475569;}
.role-tag { background:linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); color:#1d4ed8; font-size:11px; font-weight:700; padding:4px 10px; border-radius:99px; }
.empty { text-align:center; padding:60px; color:#94a3b8; font-size:15px; }
.readonly-bar { background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-bottom:2px solid #fbbf24; padding:12px 32px; font-size:13px; color:#92400e; font-weight:600; display:flex; align-items:center; gap:10px; }
.loading { text-align:center; padding:60px; color:#64748b; font-size:16px; }
@media (max-width: 900px) { .stats { grid-template-columns:repeat(2,1fr); } }
</style>
</head>
<body>
<div id="readonlyBar" class="readonly-bar" style="display:none">
  üëÅÔ∏è You're viewing this tracker in <strong>read-only mode</strong>
</div>
<div class="topbar">
  <h1>LinkedIn Outreach Tracker</h1>
  <span id="readBadge" class="read-badge" style="display:none">READ ONLY</span>
  <button class="btn-top" id="exportBtn">‚¨áÔ∏è Export CSV</button>
</div>
<div class="container">
  <div class="stats">
    <div class="stat-card"><div class="v blue" id="sTotal">0</div><div class="l">Total Leads</div></div>
    <div class="stat-card"><div class="v green" id="sReplied">0</div><div class="l">Responded</div></div>
    <div class="stat-card"><div class="v purple" id="sMeetings">0</div><div class="l">In Pipeline</div></div>
    <div class="stat-card"><div class="v orange" id="sRate">0%</div><div class="l">Response Rate</div></div>
  </div>
  <div class="controls">
    <input type="text" id="search" placeholder="üîç Search name or company..."/>
    <select id="roleFilter"><option value="">All Roles</option></select>
    <div id="statusFilters"></div>
    <div class="ml"><button class="btn-sm" id="exportBtn2">‚¨áÔ∏è Export CSV</button></div>
  </div>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Name</th><th>Company</th><th>Role</th><th>Status</th><th>Notes</th><th>Date</th></tr></thead>
      <tbody id="tbody"><tr><td colspan="6" class="loading">Loading...</td></tr></tbody>
    </table>
  </div>
</div>
<script>
const FIREBASE_URL = "https://firestore.googleapis.com/v1/projects/linkedintracker-876ef/databases/(default)/documents/teams/";
const STATUSES=["Contacted","Connection Sent","Connected","Connected - No Response","Message Sent","Replied","JD Shared","Shared for Screening","Not Interested","Moved to Interview","Meeting Set","No Response","Closed"];
const S_CLASS=["s0","s1","s2","s2b","s3","s4","s4b","s4c","s5b","s5c","s5","s6","s7"];

let leads=[],roles=[],filterStatus="All",filterRole="",search="";
const params=new URLSearchParams(location.search);
const teamId=params.get("team");
const oldData=params.get("data");

async function loadFromFirebase(teamCode) {
  try {
    const response = await fetch(FIREBASE_URL + teamCode);
    if (!response.ok) return null;
    const data = await response.json();
    if (data.fields) {
      return {
        leads: JSON.parse(data.fields.leads?.stringValue || "[]"),
        roles: JSON.parse(data.fields.roles?.stringValue || "[]")
      };
    }
    return null;
  } catch (e) {
    console.error("Firebase load error:", e);
    return null;
  }
}

function loadFromUrl() {
  try { return JSON.parse(decodeURIComponent(atob(oldData))); } catch { return null; }
}

function updateStats(){
  const t=leads.length;
  const rep=leads.filter(l=>["Replied","JD Shared","Shared for Screening","Meeting Set","Moved to Interview"].includes(l.status)).length;
  const meet=leads.filter(l=>["Meeting Set","Moved to Interview","Shared for Screening"].includes(l.status)).length;
  document.getElementById("sTotal").textContent=t;
  document.getElementById("sReplied").textContent=rep;
  document.getElementById("sMeetings").textContent=meet;
  document.getElementById("sRate").textContent=t?Math.round(rep/t*100)+"%":"0%";
}

function roleName(id){return roles.find(r=>r.id===id)?.title||id||"‚Äî";}
function sClass(s){ return S_CLASS[STATUSES.indexOf(s)]||"s0"; }

function renderRoleFilter(){
  const sel=document.getElementById("roleFilter");
  sel.innerHTML=`<option value="">All Roles</option>`+roles.map(r=>`<option value="${r.id}">${r.title}</option>`).join("");
  sel.value=filterRole;
  sel.onchange=e=>{filterRole=e.target.value;render()};
}

function renderStatusFilters(){
  const wrap=document.getElementById("statusFilters"),counts={};
  leads.forEach(l=>counts[l.status]=(counts[l.status]||0)+1);
  wrap.innerHTML=["All",...STATUSES].map(s=>{
    const c=s==="All"?leads.length:(counts[s]||0);
    if(s!=="All"&&c===0)return"";
    return`<button class="pill${filterStatus===s?" active":""}" data-s="${s}">${s} (${c})</button>`;
  }).join("");
  wrap.querySelectorAll(".pill").forEach(b=>b.addEventListener("click",()=>{filterStatus=b.dataset.s;render();}));
}

function render(){
  updateStats();
  renderStatusFilters();
  renderRoleFilter();
  const filtered=leads.filter(l=>{
    const mS=filterStatus==="All"||l.status===filterStatus;
    const mR=!filterRole||l.roleId===filterRole;
    const mQ=!search||l.name.toLowerCase().includes(search)||(l.company||"").toLowerCase().includes(search);
    return mS&&mR&&mQ;
  });
  const tbody=document.getElementById("tbody");
  if(!filtered.length){
    tbody.innerHTML=`<tr><td colspan="6" class="empty">${!leads.length?"No leads found. The link may be invalid.":"No leads match your filters."}</td></tr>`;
    return;
  }
  tbody.innerHTML=filtered.map(l=>`
    <tr>
      <td><a class="ll" href="${l.url}" target="_blank">${l.name}</a></td>
      <td style="color:#64748b">${l.company||"‚Äî"}</td>
      <td><span class="role-tag">${roleName(l.roleId)}</span></td>
      <td><span class="ss ${sClass(l.status)}">${l.status}</span></td>
      <td style="color:#64748b">${l.notes||"‚Äî"}</td>
      <td style="color:#94a3b8;font-size:12px">${l.date}</td>
    </tr>
  `).join("");
}

function exportCSV(){
  const rows=[["Name","Company","Role","LinkedIn URL","Status","Notes","Date"]];
  leads.forEach(l=>rows.push([l.name,l.company||"",roleName(l.roleId),l.url,l.status,l.notes||"",l.date]));
  const csv=rows.map(r=>r.map(v=>`"${v}"`).join(",")).join("\n");
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="linkedin-outreach.csv";
  a.click();
}

document.getElementById("exportBtn").addEventListener("click",exportCSV);
document.getElementById("exportBtn2").addEventListener("click",exportCSV);
document.getElementById("search").addEventListener("input",e=>{search=e.target.value.toLowerCase();render();});

(async()=>{
  document.getElementById("readonlyBar").style.display="flex";
  document.getElementById("readBadge").style.display="inline";
  
  let data = null;
  
  if(teamId) {
    data = await loadFromFirebase(teamId);
  } else if(oldData) {
    data = loadFromUrl();
  }
  
  if(data) {
    leads = data.leads || [];
    roles = data.roles || [];
  }
  
  render();
})();
</script>
</body>
</html>
